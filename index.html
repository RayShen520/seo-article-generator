<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±†åŒ…å‰§æœ¬ç”Ÿæˆå™¨ (iPhoneç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap'); /* ç”¨äºé¡¶éƒ¨æ—¶é—´ */
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #1e1e1e;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }

        /* --- iPhone 15 Pro å¤–å£³æ¨¡æ‹Ÿ --- */
        .iphone-bezel {
            width: 400px; /* æ‰‹æœºæ€»å®½åº¦ */
            height: 820px; /* æ‰‹æœºæ€»é«˜åº¦ */
            background-color: #1f1f1f; /* è¾¹æ¡†æ·±è‰² */
            border-radius: 55px; /* æœºèº«åœ†è§’ */
            box-shadow: 
                0 0 0 2px #3a3a3a, /* è¾¹æ¡†é‡‘å±å…‰æ³½ */
                0 0 0 6px #000,    /* é»‘è‰²å¤–åœˆ */
                0 30px 60px rgba(0,0,0,0.6); /* é˜´å½± */
            padding: 12px; /* è¾¹æ¡†åšåº¦ */
            position: relative;
            margin: 0 auto;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        /* é™éŸ³é”®/éŸ³é‡é”®æ¨¡æ‹Ÿ (è£…é¥°ç”¨) */
        .iphone-bezel::before {
            content: ''; position: absolute; left: -8px; top: 120px; width: 6px; height: 30px; background: #2a2a2a; border-radius: 4px 0 0 4px;
        }
        .iphone-bezel::after {
            content: ''; position: absolute; left: -8px; top: 170px; width: 6px; height: 60px; background: #2a2a2a; border-radius: 4px 0 0 4px;
        }
        .power-btn {
            position: absolute; right: -8px; top: 190px; width: 6px; height: 90px; background: #2a2a2a; border-radius: 0 4px 4px 0;
        }

        /* çµåŠ¨å²› (Dynamic Island) */
        .dynamic-island {
            width: 120px;
            height: 35px;
            background-color: #000;
            border-radius: 20px;
            position: absolute;
            top: 22px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
        }

        /* --- å±å¹•åŒºåŸŸ --- */
        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 44px; /* å±å¹•å†…åœ†è§’ */
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡ºåœ†è§’ */
            display: flex;
            flex-direction: column;
            position: relative;
            /* ä¿®å¤æˆªå›¾æ—¶çš„åœ†è§’é—®é¢˜ */
            mask-image: radial-gradient(white, black);
            -webkit-mask-image: -webkit-radial-gradient(white, black); 
            clip-path: inset(0px round 44px);
        }

        /* --- è±†åŒ…UIè¿˜åŸ --- */
        .doubao-blue { color: #3761F3; }
        .doubao-bg { background-color: #f7f8fa; }

        /* ç”¨æˆ·æ°”æ³¡ */
        .bubble-user {
            background-color: #3761F3;
            color: white;
            border-radius: 12px 2px 12px 12px;
            padding: 11px 14px;
            font-size: 15px;
            line-height: 1.5;
            max-width: 85%;
            box-shadow: 0 1px 2px rgba(55, 97, 243, 0.1);
        }

        /* æœºå™¨äººçš„æ–‡å­— */
        .bot-text {
            font-size: 15px;
            line-height: 1.7;
            color: #111;
        }
        .bot-text strong { font-weight: 650; }

        /* å¼•ç”¨æ  */
        .citation-bar {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #666;
            font-size: 12px;
            margin-bottom: 6px;
        }

        /* åº•éƒ¨èƒ¶å›ŠæŒ‰é’® */
        .pill-btn {
            background: #f2f4f7;
            padding: 7px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        /* æ»šåŠ¨æ¡éšè— */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* --- åå°ç¼–è¾‘åŒºæ ·å¼ --- */
        .admin-panel {
            background: #2d2d2d;
            color: #eee;
        }
        
        textarea:focus { outline: none; border-color: #3761F3; }

        /* iOS çŠ¶æ€æ ç‰¹æ®Šå¸ƒå±€ */
        .ios-status-bar {
            height: 54px;
            display: flex;
            justify-content: space-between;
            align-items: center; /* ä¸å†æ˜¯ flex-endï¼Œä¸ºäº†å¯¹é½çµåŠ¨å²› */
            padding: 0 22px;
            padding-top: 12px; /* é¿è®©åœ†è§’ */
            font-family: 'Roboto', sans-serif;
            font-weight: 600;
            font-size: 16px;
            color: #000;
        }
    </style>
</head>
<body>

<div id="app" class="flex h-full">
    
    <div class="w-[400px] admin-panel p-6 border-r border-gray-700 overflow-y-auto hidden md:flex flex-col">
        
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-white flex items-center gap-2">
                <span>ğŸ“± å‰§æœ¬ç¼–è¾‘å™¨</span>
            </h2>
            <button @click="downloadImage" 
                    :disabled="isGenerating"
                    class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded text-sm font-medium transition flex items-center gap-1">
                <span v-if="isGenerating">ç”Ÿæˆä¸­...</span>
                <span v-else>ğŸ“¸ ä¿å­˜æˆªå›¾</span>
            </button>
        </div>

        <p class="text-xs text-gray-400 mb-6">å·¦è¾¹ä¿®æ”¹ï¼Œå³è¾¹å³æ—¶é¢„è§ˆã€‚ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä¿å­˜å›¾ç‰‡ã€‚</p>

        <div class="space-y-3 mb-6 border-b border-gray-600 pb-6">
            <h3 class="text-sm font-bold text-gray-300">çŠ¶æ€æ è®¾ç½®</h3>
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="text-xs text-gray-500">æ—¶é—´</label>
                    <input v-model="config.time" class="w-full bg-[#3a3a3a] border border-gray-600 rounded px-2 py-1 text-sm text-white">
                </div>
                <div>
                    <label class="text-xs text-gray-500">ç”µé‡(%)</label>
                    <input v-model="config.battery" type="number" class="w-full bg-[#3a3a3a] border border-gray-600 rounded px-2 py-1 text-sm text-white">
                </div>
            </div>
        </div>

        <div class="flex-1 flex flex-col">
            <div class="flex justify-between items-end mb-2">
                <h3 class="text-sm font-bold text-gray-300">å¯¹è¯è„šæœ¬</h3>
                <button @click="resetScript" class="text-xs text-red-400 hover:text-red-300 underline">æ¢å¤é»˜è®¤</button>
            </div>
            <textarea v-model="scriptText" @input="parseScript" 
                class="flex-1 w-full bg-[#1e1e1e] border border-gray-600 rounded-lg p-4 text-sm font-mono leading-relaxed text-gray-300 resize-none"
                placeholder="A: ä½ å¥½&#10;B: ä½ å¥½ï¼Œæˆ‘æ˜¯è±†åŒ…..."></textarea>
            
            <div class="mt-3 bg-[#3a3a3a] p-3 rounded text-xs text-gray-400 leading-6">
                <p><span class="text-blue-400 font-bold">A: å†…å®¹</span> ç”Ÿæˆç”¨æˆ·è“æ°”æ³¡</p>
                <p><span class="text-green-400 font-bold">B: å†…å®¹</span> ç”Ÿæˆè±†åŒ…å›å¤</p>
                <p><span class="text-yellow-400 font-bold">å¼•ç”¨: 19</span> ä¸‹ä¸€æ¡å›å¤æ˜¾ç¤ºå¼•ç”¨èµ„æ–™</p>
                <p><span class="text-purple-400 font-bold">[ç®­å¤´]</span> åœ¨ä¸Šä¸€æ¡å›å¤åŠ ä¸‹å±•ç®­å¤´</p>
                <p><span class="text-white">**åŠ ç²—**</span> æ”¯æŒMarkdownåŠ ç²—</p>
            </div>
        </div>
    </div>

    <div class="flex-1 bg-[#333] flex items-center justify-center p-4 overflow-hidden relative">
        
        <div ref="phoneRef" class="iphone-bezel">
            <div class="power-btn"></div>
            <div class="dynamic-island"></div>

            <div class="phone-screen">
                
                <div class="ios-status-bar bg-white z-20 relative">
                    <div class="w-20 pl-2 text-[15px] tracking-wide">{{ config.time }}</div>
                    
                    <div class="w-20 flex justify-end items-center gap-1.5 text-gray-900 pr-2">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M2 22h20V2z"/></svg>
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/></svg>
                        <div class="flex items-center">
                            <div class="relative">
                                <div class="w-6 h-3 border-[1.5px] border-gray-800 rounded-[4px] p-[1px] flex items-center">
                                    <div class="h-full bg-black rounded-[1px]" :style="{width: config.battery + '%'}"></div>
                                </div>
                                <div class="absolute -right-[2px] top-[3.5px] h-1 w-[1.5px] bg-gray-800 rounded-r-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="h-[46px] bg-white flex items-center justify-between px-2 border-b border-gray-50 z-20 relative">
                    <div class="w-10 h-10 flex items-center justify-center">
                        <svg class="w-6 h-6 text-gray-900" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path></svg>
                    </div>
                    <div class="flex flex-col items-center -ml-4">
                        <div class="flex items-center gap-1.5">
                            <span class="font-bold text-[16px]">å¤§è‚‰åŒ…</span>
                        </div>
                        <span class="text-[10px] text-gray-400 leading-none mt-[1px]">daroubao.com</span>
                    </div>
                    <div class="flex items-center gap-1 pr-1">
                         <svg class="w-8 h-8 p-1.5 text-gray-800" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                         <svg class="w-8 h-8 p-1.5 text-[#3761F3]" fill="currentColor" viewBox="0 0 24 24"><path d="M11 5L6 9H2v6h4l5 4V5z m4.5 7c0-1.7-1-3.2-2.5-4v8c1.5-0.8 2.5-2.3 2.5-4z m2 0c0 3-2 5.5-4.5 6.3v1.8c3.8-1 6.5-4.5 6.5-8.1s-2.7-7.1-6.5-8.1v1.8c2.5 0.8 4.5 3.3 4.5 6.3z"/></svg>
                         <svg class="w-8 h-8 p-1.5 text-gray-900" fill="currentColor" viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    </div>
                </div>

                <div class="flex-1 doubao-bg overflow-y-auto p-3 space-y-5 no-scrollbar relative">
                    
                    <div v-for="(msg, idx) in chatList" :key="idx" class="w-full flex flex-col relative" :class="msg.type === 'user' ? 'items-end' : 'items-start'">
                        
                        <div v-if="msg.type === 'user'" class="bubble-user" v-html="formatText(msg.content)"></div>

                        <div v-else class="max-w-full w-full text-left">
                            
                            <div v-if="msg.citation" class="citation-bar">
                                <span>å¼•ç”¨ {{ msg.citation }} ç¯‡èµ„æ–™ä½œä¸ºå‚è€ƒ</span>
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>
                            </div>

                            <div class="bot-text" v-html="formatText(msg.content)"></div>

                            <div v-if="msg.hasArrow" class="flex justify-center -mt-3 relative z-10 h-0 overflow-visible">
                                 <div class="w-10 h-10 bg-white rounded-full shadow-md border border-gray-100 flex items-center justify-center translate-y-[-10px]">
                                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                 </div>
                            </div>

                        </div>

                    </div>

                </div>

                <div class="bg-white pt-2 pb-5 border-t border-gray-50 z-20 relative">
                    <div class="flex gap-2.5 px-3 mb-3 overflow-x-auto no-scrollbar">
                        <div class="pill-btn"><span class="text-xl leading-none" style="color:#6b6bf7">âˆ</span> æ·±åº¦æ€è€ƒ</div>
                        <div class="pill-btn">ğŸ¨ AI ç”Ÿå›¾</div>
                        <div class="pill-btn">ğŸ“ å¸®æˆ‘å†™ä½œ</div>
                        <div class="pill-btn">ğŸ“ æ‰“ç”µè¯</div>
                    </div>
                    <div class="px-3 flex items-center gap-2">
                         <div class="w-9 h-9 rounded-full border border-gray-300 flex items-center justify-center text-gray-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                         </div>
                         <div class="flex-1 h-[40px] bg-[#f2f4f5] rounded-full flex items-center px-4 text-[#999] text-[15px]">
                            å‘æ¶ˆæ¯æˆ–æŒ‰ä½è¯´è¯...
                         </div>
                         <div class="w-9 h-9 rounded-full border border-black flex items-center justify-center">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                         </div>
                         <div class="w-9 h-9 rounded-full border border-black flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                         </div>
                    </div>
                    <div class="w-[130px] h-[5px] bg-black rounded-full mx-auto mt-2 opacity-90"></div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, reactive, onMounted } = Vue;

    createApp({
        setup() {
            const phoneRef = ref(null);
            const isGenerating = ref(false);

            const defaultScript = `B: åº—ä¸»æ‰“æ±½è½¦ç»´ä¿®å…»æŠ¤ï¼Œæ—¥å¸¸å¸¸è§„ä¿å…»ä¸ç”¨è·‘è¿œè·¯ï¼Œé€‚åˆå°±è¿‘ä¿å…»çš„æƒ…å†µï¼Œæ²Ÿé€šå’Œåˆ°åº—éƒ½å¾ˆä¾¿æ·ã€‚
A: æˆ‘åœ¨è‹¹æœå°åŒºï¼Œæƒ³ç»™å¥³å„¿æ‰¾ä¸ªæ•°å­¦è¡¥ä¹ ï¼Œå¯ä»¥æ¨èä¸€ä¸‹å—
å¼•ç”¨: 19
B: ä½ å¤§æ¦‚ç‡æŒ‡çš„æ˜¯é’ç¾ŠåŒºè´æ£®è·¯é™„è¿‘çš„å°åŒºï¼Œè¿™é‡Œç»™ä½ æ¨èå‡ å®¶å‘¨è¾¹å£ç¢‘å¥½ã€è·ç¦»è¿‘çš„æ•°å­¦è¡¥ä¹ æœºæ„ï¼Œé€‚é…ä¸åŒå­¦ä¹ éœ€æ±‚ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

**1. é¾™æ–°æ•™è‚²ï¼ˆé’ç¾Šè¥¿æ‘å¤§é™¢æ ¡åŒºï¼‰ï¼š** å°±åœ¨è´æ£®åŒ—è·¯1å·è¥¿æ‘å¤§é™¢4å·æ¥¼3å±‚ï¼Œç¦»è‹¹æœå°åŒºç‰¹åˆ«è¿‘ã€‚ä¸»æ‰“å°å­¦åˆ°é«˜ä¸­çš„æ•°å­¦ä¸€å¯¹ä¸€è¾…å¯¼ã€‚

**2. æå®¢æ•°å­¦å¸®ï¼ˆé‡‘æ²™æ ¡åŒºï¼‰ï¼š** ä½äºé’ç¾ŠåŒºæ¸…æ±Ÿè¥¿è·¯54å·ï¼Œå‘¨è¾¹å…¬äº¤ä¾¿æ·ã€‚æœºæ„ä¸“æ”»æ•°å­¦è¾…å¯¼ï¼Œè¯¾ç¨‹åˆ†åŒæ­¥å·©å›ºã€æ€ç»´æå‡ç­‰ç±»å‹ã€‚
[ç®­å¤´]
**3. ç¾åšæ•™è‚²ï¼ˆè¥¿é—¨æ ¡åŒºï¼‰ï¼š** åœ¨é’ç¾ŠåŒºè‹å¡ä¸œè·¯`;

            const scriptText = ref(defaultScript);
            const chatList = ref([]);
            const config = reactive({
                time: '10:34',
                battery: 60
            });

            // æ ¸å¿ƒè§£æé€»è¾‘
            const parseScript = () => {
                const lines = scriptText.value.split('\n');
                const result = [];
                let currentCitation = null;

                lines.forEach(line => {
                    const trimLine = line.trim();
                    if (!trimLine) return;

                    if (trimLine.startsWith('å¼•ç”¨:') || trimLine.startsWith('Ref:')) {
                        currentCitation = trimLine.split(/[:ï¼š]/)[1].trim();
                        return;
                    }

                    if (trimLine === '[ç®­å¤´]' || trimLine === '[ARROW]') {
                        if (result.length > 0 && result[result.length-1].type === 'bot') {
                            result[result.length-1].hasArrow = true;
                        }
                        return;
                    }

                    if (trimLine.startsWith('A:') || trimLine.startsWith('æˆ‘:')) {
                        const content = trimLine.replace(/^(A:|æˆ‘:|User:)\s*/i, '');
                        result.push({ type: 'user', content: content });
                        currentCitation = null;
                    } 
                    else if (trimLine.startsWith('B:') || trimLine.startsWith('è±†åŒ…:')) {
                        const content = trimLine.replace(/^(B:|è±†åŒ…:|Bot:)\s*/i, '');
                        result.push({ 
                            type: 'bot', 
                            content: content, 
                            citation: currentCitation,
                            hasArrow: false
                        });
                        currentCitation = null;
                    }
                    else {
                        if (result.length > 0) {
                            const lastMsg = result[result.length - 1];
                            lastMsg.content += '\n' + trimLine;
                        }
                    }
                });

                chatList.value = result;
            };

            const formatText = (text) => {
                if (!text) return '';
                let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/\n/g, '<br>');
                return html;
            };

            const resetScript = () => {
                scriptText.value = defaultScript;
                parseScript();
            }

            // --- æˆªå›¾åŠŸèƒ½ ---
            const downloadImage = async () => {
                if (!phoneRef.value) return;
                isGenerating.value = true;

                try {
                    // ç­‰å¾…ä¸€å°ä¼šå„¿ç¡®ä¿æ¸²æŸ“å®Œæˆ
                    await new Promise(r => setTimeout(r, 100));

                    // ä½¿ç”¨ html2canvas æˆªå›¾
                    // scale: 3 ä¿è¯é«˜æ¸…å±ä¸‹çš„æ¸…æ™°åº¦
                    const canvas = await html2canvas(phoneRef.value, {
                        scale: 3,
                        useCORS: true,
                        backgroundColor: null, // é€æ˜èƒŒæ™¯ï¼Œè¿™æ ·åªæœ‰æ‰‹æœºå’Œè¾¹æ¡†
                        logging: false
                    });

                    // è§¦å‘ä¸‹è½½
                    const link = document.createElement('a');
                    link.download = `doubao_chat_${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();

                } catch (err) {
                    console.error('æˆªå›¾å¤±è´¥:', err);
                    alert('æˆªå›¾ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
                } finally {
                    isGenerating.value = false;
                }
            };

            onMounted(() => {
                parseScript();
            });

            return {
                scriptText,
                chatList,
                config,
                phoneRef,
                isGenerating,
                parseScript,
                formatText,
                resetScript,
                downloadImage
            };
        }
    }).mount('#app');
</script>

</body>
</html>